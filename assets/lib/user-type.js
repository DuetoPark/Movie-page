"use strict";// 전역변수
var sectionOfHistory=document.querySelector("#history"),searchButton=document.querySelector(".search"),searchInput=document.querySelector("#order-number"),cancelButton=document.querySelector("#history .cancel");// 예매확인 - 조회하기 버튼 활성화
function toggleSearchButton(){var isFilled=!!searchInput.value,isInactived=searchButton.classList.contains("inactive");isFilled&&isInactived&&(searchButton.classList.remove("inactive"),searchButton.setAttribute("tabindex",0)),isFilled||isInactived||(searchButton.classList.add("inactive"),searchButton.setAttribute("tabindex",-1))}searchInput.addEventListener("keyup",toggleSearchButton);// 예매확인 - 예약번호 조회
function compareSeat(data,index){return data.sort(function(a,b){var lastNumber=a.split("-")[index],nextNumber=b.split("-")[index];return lastNumber<nextNumber?-1:1}),data}function displayName(data){var section=document.querySelector("#history-name .mypage-desc"),koreanName=state.reservation.time[data.movie.name].name,time=data.movie.time[0],nameHTML="<strong>".concat(koreanName,"</strong>(<strong>").concat(time,"</strong>)");section.innerHTML=nameHTML}function displaySeat(data){var section=document.querySelector("#history-seat .mypage-desc"),sortNumber=compareSeat(data.seat,1),sortText=compareSeat(sortNumber,0),arrayOfseatsHTML=sortText.map(function(seat){return"<span>".concat(seat.split("-").join(""),"</span>")});section.innerHTML="<strong>".concat(arrayOfseatsHTML,"</strong>")}function displayCount(data){var sectionOfTotal=document.querySelector("#history-count .mypage-desc"),sectionOfDetails=document.querySelector("#history-count .details"),detailsHTML="";for(var key in data.count)if(data.count[key]&&"total"!=key){var value=data.count[key],text=state.reservation.count[key].text,textHTML="<span>".concat(text," ").concat(value,"\uBA85</span>");detailsHTML+=textHTML}sectionOfTotal.innerHTML="<strong>\uCD1D ".concat(data.count.total,"\uBA85</strong>"),sectionOfDetails.innerHTML=detailsHTML}function toggleHistory(active){sectionOfHistory.classList[active?"remove":"add"]("hidden"),sectionOfHistory.classList[active?"add":"remove"]("active"),cancelButton.setAttribute("tabindex",[active?0:-1])}function searchReservation(){var userOrderData=JSON.parse(window.localStorage.getItem("userOrderData")),orderNumber=searchInput.value,isincluding=userOrderData.findIndex(function(element){return element.order===orderNumber});0<=isincluding?(toggleHistory(!0),displayName(userOrderData[isincluding]),displaySeat(userOrderData[isincluding]),displayCount(userOrderData[isincluding]),sessionStorage.setItem("searchedOrderData",JSON.stringify(userOrderData[isincluding]))):-1===isincluding&&(alert("\uC785\uB825\uD558\uC2E0 \uBC88\uD638\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uD655\uC778\uD574 \uC8FC\uC2DC\uAE30 \uBC14\uB78D\uB2C8\uB2E4."),searchInput.value="",toggleHistory(!1))}searchButton.addEventListener("click",searchReservation);// 예매확인 - 예매취소
var searchedOrderData,userOrderData;function getStorageData(storage,key){return JSON.parse(storage.getItem(key))}function saveChangedData(storage,key,changedData){storage.setItem(key,JSON.stringify(changedData))}function returnCancelMessage(){return"\n  \uC608\uC57D \uBC88\uD638: ".concat(searchedOrderData.order,"\n  \uC601\uD654\uBA85: ").concat(searchedOrderData.movie.name,"(").concat(searchedOrderData.movie.time[0],")\n  \uC778\uC6D0: \uCD1D ").concat(searchedOrderData.count.total,"\uBA85\n  ")}function returnChangedSeastData(seatData){var name=searchedOrderData.movie.name,time=searchedOrderData.movie.time[1],seat=searchedOrderData.seat;return seat.forEach(function(seat){var key=seat.split("-")[0],index=seat.split("-")[1]-1;seatData[name][time][key][index]=0}),seatData}function returnChangedUserOrderData(){// 일치하는 데이터 찾기
var index=userOrderData.findIndex(function(element){return element.order===searchedOrderData.order});// 찾은 데이터 삭제
return userOrderData.splice(index,1),userOrderData}function hideHistory(){sectionOfHistory.classList.add("hidden"),searchInput.value=""}function cancelReservation(){// 취소 의사 다시 확인
if(searchedOrderData=getStorageData(sessionStorage,"searchedOrderData"),!0===confirm(returnCancelMessage()))alert("\uC608\uB9E4 \uCDE8\uC18C\uAC00 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");else return;var seatData=getStorageData(localStorage,"seatData");userOrderData=getStorageData(localStorage,"userOrderData"),saveChangedData(localStorage,"seatData",returnChangedSeastData(seatData)),saveChangedData(localStorage,"userOrderData",returnChangedUserOrderData()),hideHistory()}cancelButton.addEventListener("click",cancelReservation);